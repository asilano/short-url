# README

## Installation

1. Clone this repository
2. `bundle install`
3. (If necessary, `yarn install --check-files`)
4. `bin/rails db:migrate`
5. `bin/rails s`
6. App is served on `localhost:3000`

This app is developed under Ruby 2.7.2, specified in `.ruby-version`, but should be compatible with older Ruby
versions. Only the development environment is set up.

## Additional information

User management is by [`devise`](https://github.com/heartcombo/devise), because there's no reason to write my own
passably-secure logon system when a long-standing gem can do the job for me. Users are registerable and
password-authenticated, and can have their sessions remembered.

Short URLs are generated by converting 4 random bytes into URL-safe Base64, via the `secure_random` library. This
provides up to 4 billion unique short URLs, but can't guarantee that they won't clash. Practically, a clash is
extremely unlikely until around half of those have been used up; and if there _is_ a clash we try another couple of
random strings before effectively giving up (by letting the duplicate short form fail uniqueness validation) and
returning an error.

It would of course be possible to guarantee no clashes - for instance, by allocating each short URL of the form
`/#{id}`. However, I chose a small number of random characters both to mimic existing services such as bit.ly, and
to preclude systematic guessing of other users' short URLs.

## Further work

Building a Rails app from scratch is somewhat time-consuming; there are therefore some things I would like to have
done that I did not have time to do.

* Tests. It pains me that I am submitting this without a single test. I would normally have unit-tested the
`ShortenedUrl` model _at least_, and system-tested full end-to-end behaviour, checking success paths plus failure
scenarios both likely and ridiculous. (Unit testing the `User` model is mildly superfluous, as I trust `devise` to
do its job).
* A fuller User-management setup. This meets the brief, but isn't very nice. Apart from anything, there's no way to
recover a lost password. I had to omit this because, although `devise` would make it easy enough to add, it would
also require setup of mailers etc.
* Styling. Everything here is using Rails and `devise`'s default layouts and styling. The one exception is a little
padding and zebra-striping on the ShortUrl index table, for readability.

## Known bugs

There is one bug I have encountered that is worth mentioning. Sometimes, the target URL and Short URL display as
links, both in the index table, and on the `show` view. This is despite them clearly not being links in the view
code. When the short URL is displayed as a link, clicking that link increments the visited count by 2.

I have been unable to determine the cause of this bug; although my initial suspicion is on Turbolinks, which may be
pre-fetching links on the page in order to provide a faster response.
